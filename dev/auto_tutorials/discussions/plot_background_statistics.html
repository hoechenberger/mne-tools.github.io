<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Statistical inference &#8212; MNE 0.23.dev0 documentation</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/bootstrap_divs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery-rendered-html.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/bootstrap_divs.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

    <link rel="canonical" href="https://mne.tools/stable/index.html" />
    <script type="text/javascript" src="../../_static/copybutton.js"></script>


    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37225609-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>


    <link rel="stylesheet" href="../../_static/style.css " type="text/css" />
    <link rel="stylesheet" href="../../_static/font-awesome.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/font-source-code-pro.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/font-source-sans-pro.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/flag-icon.css" type="text/css" />


    <script type="text/javascript">
    (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
    </script>



<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>



  </head><body>

<div class="d-block devbar alert alert-danger">
This is documentation for the <em>unstable development version</em> of MNE-Python,
<a href="https://mne.tools/dev/install/advanced.html#using-the-development-version-of-mne-python-latest-master">available here</a>.
Or, switch to documentation for the <a href="https://mne.tools/stable">current stable version</a>.

</div>





  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html"><span><img src="../../_static/mne_logo_small.svg"></span>
           </a>
        <span class="navbar-text navbar-version pull-left"><b>0.23.dev0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../install/index.html">Install</a></li>
                <li><a href="../../overview/index.html">Overview</a></li>
                <li><a href="../index.html">Tutorials</a></li>
                <li><a href="../../auto_examples/index.html">Examples</a></li>
                <li><a href="../../glossary.html">Glossary</a></li>
                <li><a href="../../python_reference.html">API</a></li>
            
            
            <li class="dropdown globaltoc-container">
              <a role="button" id="dLabelGlobalToc" data-toggle="dropdown" data-target="#" href="#">More<b class="caret"></b></a>
              <ul class="dropdown-menu globaltoc" role="menu" aria-labelledby="dLabelGlobalToc">
                <li><a href="https://github.com/mne-tools/mne-python"><i class="fa fa-github"></i> GitHub</a></li>
                <li><a href="../../overview/get_help.html"><i class="fa fa-question-circle"></i> Get help</a></li>
                <li><a href="../../install/contributing.html"><i class="fa fa-code-fork"></i> Contribute</a></li>
                <li><a href="../../overview/cite.html"><i class="fa fa-book"></i> Cite MNE</a></li>
              </ul>
            </li>

            <li class="dropdown">
              <button type="button" class="btn btn-danger btn-sm navbar-btn dropdown-toggle" id="dLabelMore" data-toggle="dropdown" style="margin-left: 10px">
              v0.23.dev0
              <span class="caret"></span>
            </button>
              <ul class="dropdown-menu" aria-labelledby="dLabelMore">
                <li><a href="https://mne-tools.github.io/dev/index.html">Development</a></li>
                <li><a href="https://mne-tools.github.io/stable/index.html">v0.22 (stable)</a></li>
                <li><a href="https://mne-tools.github.io/0.21/index.html">v0.21</a></li>
                <li><a href="https://mne-tools.github.io/0.20/index.html">v0.20</a></li>
                <li><a href="https://mne-tools.github.io/0.19/index.html">v0.19</a></li>
                <li><a href="https://mne-tools.github.io/0.18/index.html">v0.18</a></li>
                <li><a href="https://mne-tools.github.io/0.17/index.html">v0.17</a></li>
                <li><a href="https://mne-tools.github.io/0.16/index.html">v0.16</a></li>
                <li><a href="https://mne-tools.github.io/0.15/index.html">v0.15</a></li>
                <li><a href="https://mne-tools.github.io/0.14/index.html">v0.14</a></li>
                <li><a href="https://mne-tools.github.io/0.13/index.html">v0.13</a></li>
                <li><a href="https://mne-tools.github.io/0.12/index.html">v0.12</a></li>
                <li><a href="https://mne-tools.github.io/0.11/index.html">v0.11</a></li>
              </ul>
            </li>

            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-tutorials-discussions-plot-background-statistics-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="statistical-inference">
<span id="disc-stats"></span><span id="sphx-glr-auto-tutorials-discussions-plot-background-statistics-py"></span><h1>Statistical inference<a class="headerlink" href="#statistical-inference" title="Permalink to this headline">¶</a></h1>
<p>Here we will briefly cover multiple concepts of inferential statistics in an
introductory manner, and demonstrate how to use some MNE statistical functions.</p>
<div class="contents local topic" id="topics">
<p class="topic-title">Topics</p>
<ul class="simple">
<li><p><a class="reference internal" href="#hypothesis-testing" id="id8">Hypothesis testing</a></p>
<ul>
<li><p><a class="reference internal" href="#null-hypothesis" id="id9">Null hypothesis</a></p></li>
<li><p><a class="reference internal" href="#parametric-tests" id="id10">Parametric tests</a></p>
<ul>
<li><p><a class="reference internal" href="#hat-variance-adjustment" id="id11">“Hat” variance adjustment</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#non-parametric-tests" id="id12">Non-parametric tests</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#multiple-comparisons" id="id13">Multiple comparisons</a></p>
<ul>
<li><p><a class="reference internal" href="#bonferroni-correction" id="id14">Bonferroni correction</a></p></li>
<li><p><a class="reference internal" href="#false-discovery-rate-fdr-correction" id="id15">False discovery rate (FDR) correction</a></p></li>
<li><p><a class="reference internal" href="#non-parametric-resampling-test-with-a-maximum-statistic" id="id16">Non-parametric resampling test with a maximum statistic</a></p></li>
<li><p><a class="reference internal" href="#clustering" id="id17">Clustering</a></p>
<ul>
<li><p><a class="reference internal" href="#defining-the-adjacency-matrix" id="id18">Defining the adjacency matrix</a></p></li>
<li><p><a class="reference internal" href="#standard-clustering" id="id19">Standard clustering</a></p></li>
<li><p><a class="reference internal" href="#id3" id="id20">“Hat” variance adjustment</a></p></li>
<li><p><a class="reference internal" href="#threshold-free-cluster-enhancement-tfce" id="id21">Threshold-free cluster enhancement (TFCE)</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#visualize-and-compare-methods" id="id22">Visualize and compare methods</a></p></li>
<li><p><a class="reference internal" href="#statistical-functions-in-mne" id="id23">Statistical functions in MNE</a></p>
<ul>
<li><p><a class="reference internal" href="#parametric-methods-provided-by-mne" id="id24">Parametric methods provided by MNE</a></p></li>
<li><p><a class="reference internal" href="#non-parametric-methods" id="id25">Non-parametric methods</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#references" id="id26">References</a></p></li>
</ul>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Authors: Eric Larson &lt;larson.eric.d@gmail.com&gt;</span>
<span class="c1"># License: BSD (3-clause)</span>

<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <a href="https://docs.python.org/3/library/functools.html#functools.partial" title="functools.partial" class="sphx-glr-backref-module-functools sphx-glr-backref-type-py-function"><span class="n">partial</span></a>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>  <span class="c1"># noqa, analysis:ignore</span>

<span class="kn">import</span> <span class="nn">mne</span>
<span class="kn">from</span> <span class="nn">mne.stats</span> <span class="kn">import</span> <span class="p">(</span><a href="../../generated/mne.stats.ttest_1samp_no_p.html#mne.stats.ttest_1samp_no_p" title="mne.stats.ttest_1samp_no_p" class="sphx-glr-backref-module-mne-stats sphx-glr-backref-type-py-function"><span class="n">ttest_1samp_no_p</span></a><span class="p">,</span> <a href="../../generated/mne.stats.bonferroni_correction.html#mne.stats.bonferroni_correction" title="mne.stats.bonferroni_correction" class="sphx-glr-backref-module-mne-stats sphx-glr-backref-type-py-function"><span class="n">bonferroni_correction</span></a><span class="p">,</span> <a href="../../generated/mne.stats.fdr_correction.html#mne.stats.fdr_correction" title="mne.stats.fdr_correction" class="sphx-glr-backref-module-mne-stats sphx-glr-backref-type-py-function"><span class="n">fdr_correction</span></a><span class="p">,</span>
                       <a href="../../generated/mne.stats.permutation_t_test.html#mne.stats.permutation_t_test" title="mne.stats.permutation_t_test" class="sphx-glr-backref-module-mne-stats sphx-glr-backref-type-py-function"><span class="n">permutation_t_test</span></a><span class="p">,</span> <a href="../../generated/mne.stats.permutation_cluster_1samp_test.html#mne.stats.permutation_cluster_1samp_test" title="mne.stats.permutation_cluster_1samp_test" class="sphx-glr-backref-module-mne-stats sphx-glr-backref-type-py-function"><span class="n">permutation_cluster_1samp_test</span></a><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="vm">__doc__</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="hypothesis-testing">
<h2><a class="toc-backref" href="#id8">Hypothesis testing</a><a class="headerlink" href="#hypothesis-testing" title="Permalink to this headline">¶</a></h2>
<div class="section" id="null-hypothesis">
<h3><a class="toc-backref" href="#id9">Null hypothesis</a><a class="headerlink" href="#null-hypothesis" title="Permalink to this headline">¶</a></h3>
<p>From <a class="reference external" href="https://en.wikipedia.org/wiki/Null_hypothesis">Wikipedia</a>:</p>
<blockquote>
<div><p>In inferential statistics, a general statement or default position that
there is no relationship between two measured phenomena, or no
association among groups.</p>
</div></blockquote>
<p>We typically want to reject a <strong>null hypothesis</strong> with
some probability (e.g., p &lt; 0.05). This probability is also called the
significance level <span class="math notranslate nohighlight">\(\alpha\)</span>.
To think about what this means, let’s follow the illustrative example from
<a class="footnote-reference brackets" href="#id6" id="id1">1</a> and construct a toy dataset consisting of a 40 x 40 square with a
“signal” present in the center with white noise added and a Gaussian
smoothing kernel applied.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">width</span></a> <span class="o">=</span> <span class="mi">40</span>
<a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_subjects</span></a> <span class="o">=</span> <span class="mi">10</span>
<a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">signal_mean</span></a> <span class="o">=</span> <span class="mi">100</span>
<a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">signal_sd</span></a> <span class="o">=</span> <span class="mi">100</span>
<a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">noise_sd</span></a> <span class="o">=</span> <span class="mf">0.01</span>
<a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">gaussian_sd</span></a> <span class="o">=</span> <span class="mi">5</span>
<a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sigma</span></a> <span class="o">=</span> <span class="mf">1e-3</span>  <span class="c1"># sigma for the &quot;hat&quot; method</span>
<a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_permutations</span></a> <span class="o">=</span> <span class="s1">&#39;all&#39;</span>  <span class="c1"># run an exact test</span>
<a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_src</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">width</span></a> <span class="o">*</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">width</span></a>

<span class="c1"># For each &quot;subject&quot;, make a smoothed noisy signal with a centered peak</span>
<a href="https://numpy.org/devdocs/reference/random/legacy.html#numpy.random.RandomState" title="numpy.random.RandomState" class="sphx-glr-backref-module-numpy-random sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">rng</span></a> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/random/legacy.html#numpy.random.RandomState" title="numpy.random.RandomState" class="sphx-glr-backref-module-numpy-random sphx-glr-backref-type-py-class"><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span></a><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">noise_sd</span></a> <span class="o">*</span> <a href="https://numpy.org/devdocs/reference/random/legacy.html#numpy.random.RandomState" title="numpy.random.RandomState" class="sphx-glr-backref-module-numpy-random sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">rng</span></a><span class="o">.</span><span class="n">randn</span><span class="p">(</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_subjects</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">width</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">width</span></a><span class="p">)</span>
<span class="c1"># Add a signal at the center</span>
<a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">[:,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">width</span></a> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">width</span></a> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">signal_mean</span></a> <span class="o">+</span> <a href="https://numpy.org/devdocs/reference/random/legacy.html#numpy.random.RandomState" title="numpy.random.RandomState" class="sphx-glr-backref-module-numpy-random sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">rng</span></a><span class="o">.</span><span class="n">randn</span><span class="p">(</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_subjects</span></a><span class="p">)</span> <span class="o">*</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">signal_sd</span></a>
<span class="c1"># Spatially smooth with a 2D Gaussian kernel</span>
<a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">size</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">width</span></a> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
<a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">gaussian</span></a> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">exp</span></a><span class="p">(</span><span class="o">-</span><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.arange.html#numpy.arange" title="numpy.arange" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">arange</span></a><span class="p">(</span><span class="o">-</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">size</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">size</span></a> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">gaussian_sd</span></a> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span>
<span class="k">for</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">si</span></a> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span><span class="o">.</span><span class="n">shape</span></a><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="k">for</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ri</span></a> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span><span class="o">.</span><span class="n">shape</span></a><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">[</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">si</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ri</span></a><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.convolve.html#numpy.convolve" title="numpy.convolve" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">convolve</span></a><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">[</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">si</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ri</span></a><span class="p">,</span> <span class="p">:],</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">gaussian</span></a><span class="p">,</span> <span class="s1">&#39;same&#39;</span><span class="p">)</span>
    <span class="k">for</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ci</span></a> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span><span class="o">.</span><span class="n">shape</span></a><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
        <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">[</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">si</span></a><span class="p">,</span> <span class="p">:,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ci</span></a><span class="p">]</span> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.convolve.html#numpy.convolve" title="numpy.convolve" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">convolve</span></a><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">[</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">si</span></a><span class="p">,</span> <span class="p">:,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ci</span></a><span class="p">],</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">gaussian</span></a><span class="p">,</span> <span class="s1">&#39;same&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The data averaged over all subjects looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://matplotlib.org/api/_as_gen/matplotlib.figure.Figure.html#matplotlib.figure.Figure" title="matplotlib.figure.Figure" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fig</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax</span></a> <span class="o">=</span> <a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">()</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax</span><span class="o">.</span><span class="n">imshow</span></a><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax</span><span class="o">.</span><span class="n">set</span></a><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Data averaged over subjects&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="Data averaged over subjects" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_statistics_001.png" />
<p>In this case, a null hypothesis we could test for each voxel is:</p>
<blockquote>
<div><p>There is no difference between the mean value and zero
(<span class="math notranslate nohighlight">\(H_0 \colon \mu = 0\)</span>).</p>
</div></blockquote>
<p>The alternative hypothesis, then, is that the voxel has a non-zero mean
(<span class="math notranslate nohighlight">\(H_1 \colon \mu \neq 0\)</span>).
This is a <em>two-tailed</em> test because the mean could be less than
or greater than zero, whereas a <em>one-tailed</em> test would test only one of
these possibilities, i.e. <span class="math notranslate nohighlight">\(H_1 \colon \mu \geq 0\)</span> or
<span class="math notranslate nohighlight">\(H_1 \colon \mu \leq 0\)</span>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Here we will refer to each spatial location as a “voxel”.
In general, though, it could be any sort of data value,
including cortical vertex at a specific time, pixel in a
time-frequency decomposition, etc.</p>
</div>
</div>
<div class="section" id="parametric-tests">
<h3><a class="toc-backref" href="#id10">Parametric tests</a><a class="headerlink" href="#parametric-tests" title="Permalink to this headline">¶</a></h3>
<p>Let’s start with a <strong>paired t-test</strong>, which is a standard test
for differences in paired samples. Mathematically, it is equivalent
to a 1-sample t-test on the difference between the samples in each condition.
The paired t-test is <strong>parametric</strong>
because it assumes that the underlying sample distribution is Gaussian, and
is only valid in this case. This happens to be satisfied by our toy dataset,
but is not always satisfied for neuroimaging data.</p>
<p>In the context of our toy dataset, which has many voxels
(<span class="math notranslate nohighlight">\(40 \cdot 40 = 1600\)</span>), applying the paired t-test is called a
<em>mass-univariate</em> approach as it treats each voxel independently.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">titles</span></a> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span>
<a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">out</span></a> <span class="o">=</span> <a href="https://scipy.github.io/devdocs/generated/scipy.stats.ttest_1samp.html#scipy.stats.ttest_1samp" title="scipy.stats.ttest_1samp" class="sphx-glr-backref-module-scipy-stats sphx-glr-backref-type-py-function"><span class="n">stats</span><span class="o">.</span><span class="n">ttest_1samp</span></a><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ts</span></a> <span class="o">=</span> <span class="p">[</span><a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">out</span></a><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ps</span></a> <span class="o">=</span> <span class="p">[</span><a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">out</span></a><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mccs</span></a> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span>  <span class="c1"># these are not multiple-comparisons corrected</span>


<span class="k">def</span> <span class="nf">plot_t_p</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">p</span></a><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">mcc</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <a href="https://matplotlib.org/api/_as_gen/matplotlib.figure.Figure.html#matplotlib.figure.Figure" title="matplotlib.figure.Figure" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fig</span></a> <span class="o">=</span> <a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.figure.html#matplotlib.pyplot.figure" title="matplotlib.pyplot.figure" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span></a><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><a href="https://matplotlib.org/api/_as_gen/matplotlib.figure.Figure.html#matplotlib.figure.Figure.add_subplot" title="matplotlib.figure.Figure.add_subplot" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-method"><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span></a><span class="p">(</span><span class="mi">121</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">),</span> <a href="https://matplotlib.org/api/_as_gen/matplotlib.figure.Figure.html#matplotlib.figure.Figure.add_subplot" title="matplotlib.figure.Figure.add_subplot" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-method"><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span></a><span class="p">(</span><span class="mi">122</span><span class="p">)]</span>
        <span class="n">show</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">show</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">p_lims</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">]</span>
    <span class="n">t_lims</span> <span class="o">=</span> <span class="o">-</span><a href="https://scipy.github.io/devdocs/generated/scipy.stats.rv_continuous.ppf.html#scipy.stats.rv_continuous.ppf" title="scipy.stats.rv_continuous.ppf" class="sphx-glr-backref-module-scipy-stats sphx-glr-backref-type-py-method"><span class="n">stats</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span></a><span class="p">(</span><span class="n">p_lims</span><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_subjects</span></a> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">p_lims</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">log10</span></a><span class="p">(</span><a href="https://numpy.org/devdocs/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">p</span></a><span class="p">)</span> <span class="k">for</span> <a href="https://numpy.org/devdocs/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">p</span></a> <span class="ow">in</span> <span class="n">p_lims</span><span class="p">]</span>
    <span class="c1"># t plot</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.mgrid.html#numpy.mgrid" title="numpy.mgrid" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-data"><span class="n">np</span><span class="o">.</span><span class="n">mgrid</span></a><span class="p">[</span><span class="mi">0</span><span class="p">:</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">width</span></a><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">width</span></a><span class="p">]</span>
    <span class="n">surf</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.reshape.html#numpy.reshape" title="numpy.reshape" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">reshape</span></a><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="p">(</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">width</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">width</span></a><span class="p">)),</span>
                                <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="n">vmin</span><span class="o">=</span><span class="n">t_lims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmax</span><span class="o">=</span><span class="n">t_lims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">zticks</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">width</span></a> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">width</span></a> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.colorbar.html#matplotlib.pyplot.colorbar" title="matplotlib.pyplot.colorbar" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax</span></a><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span>
                        <span class="n">fraction</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.025</span><span class="p">,</span> <span class="n">mappable</span><span class="o">=</span><span class="n">surf</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">t_lims</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%0.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">t_lim</span> <span class="k">for</span> <span class="n">t_lim</span> <span class="ow">in</span> <span class="n">t_lims</span><span class="p">])</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;t-value&#39;</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax</span></a><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mcc</span><span class="p">:</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">set_weight</span><span class="p">(</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="c1"># p plot</span>
    <span class="n">use_p</span> <span class="o">=</span> <span class="o">-</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">log10</span></a><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.reshape.html#numpy.reshape" title="numpy.reshape" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">reshape</span></a><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">maximum</span></a><span class="p">(</span><a href="https://numpy.org/devdocs/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">p</span></a><span class="p">,</span> <span class="mf">1e-5</span><span class="p">),</span> <span class="p">(</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">width</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">width</span></a><span class="p">)))</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">use_p</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;inferno&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">p_lims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vmax</span><span class="o">=</span><span class="n">p_lims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                         <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticks</span><span class="o">=</span><span class="p">[])</span>
    <span class="n">cbar</span> <span class="o">=</span> <a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.colorbar.html#matplotlib.pyplot.colorbar" title="matplotlib.pyplot.colorbar" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax</span></a><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span>
                        <span class="n">fraction</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.025</span><span class="p">,</span> <span class="n">mappable</span><span class="o">=</span><span class="n">img</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">p_lims</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%0.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">p_lim</span> <span class="k">for</span> <span class="n">p_lim</span> <span class="ow">in</span> <span class="n">p_lims</span><span class="p">])</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$-\log_</span><span class="si">{10}</span><span class="s1">(p)$&#39;</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax</span></a><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <a href="https://matplotlib.org/api/_as_gen/matplotlib.figure.Figure.html#matplotlib.figure.Figure.suptitle" title="matplotlib.figure.Figure.suptitle" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-method"><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span></a><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mcc</span><span class="p">:</span>
            <span class="n">text</span><span class="o">.</span><span class="n">set_weight</span><span class="p">(</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
        <a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.subplots_adjust.html#matplotlib.pyplot.subplots_adjust" title="matplotlib.pyplot.subplots_adjust" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span></a><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">mne</span><span class="o">.</span><span class="n">viz</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">plt_show</span><span class="p">()</span>


<span class="n">plot_t_p</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ts</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ps</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">titles</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mccs</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<img alt="t" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_statistics_002.png" />
<div class="section" id="hat-variance-adjustment">
<h4><a class="toc-backref" href="#id11">“Hat” variance adjustment</a><a class="headerlink" href="#hat-variance-adjustment" title="Permalink to this headline">¶</a></h4>
<p>The “hat” technique regularizes the variance values used in the t-test
calculation <a class="footnote-reference brackets" href="#id6" id="id2">1</a> to compensate for implausibly small variances.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ts</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><a href="../../generated/mne.stats.ttest_1samp_no_p.html#mne.stats.ttest_1samp_no_p" title="mne.stats.ttest_1samp_no_p" class="sphx-glr-backref-module-mne-stats sphx-glr-backref-type-py-function"><span class="n">ttest_1samp_no_p</span></a><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sigma</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sigma</span></a><span class="p">))</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ps</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><a href="https://scipy.github.io/devdocs/generated/scipy.stats.rv_continuous.sf.html#scipy.stats.rv_continuous.sf" title="scipy.stats.rv_continuous.sf" class="sphx-glr-backref-module-scipy-stats sphx-glr-backref-type-py-method"><span class="n">stats</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">sf</span></a><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ufunc.html#numpy.ufunc" title="numpy.ufunc" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">abs</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ts</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">titles</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\mathrm{t_</span><span class="si">{hat}</span><span class="s1">}$&#39;</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mccs</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plot_t_p</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ts</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ps</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">titles</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mccs</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<img alt="$\mathrm{t_{hat}}$" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_statistics_003.png" />
</div>
</div>
<div class="section" id="non-parametric-tests">
<h3><a class="toc-backref" href="#id12">Non-parametric tests</a><a class="headerlink" href="#non-parametric-tests" title="Permalink to this headline">¶</a></h3>
<p>Instead of assuming an underlying Gaussian distribution, we could instead
use a <strong>non-parametric resampling</strong> method. In the case of a paired t-test
between two conditions A and B, which is mathematically equivalent to a
one-sample t-test between the difference in the conditions A-B, under the
null hypothesis we have the principle of <strong>exchangeability</strong>. This means
that, if the null is true, we can exchange conditions and not change
the distribution of the test statistic.</p>
<p>When using a paired t-test, exchangeability thus means that we can flip the
signs of the difference between A and B. Therefore, we can construct the
<strong>null distribution</strong> values for each voxel by taking random subsets of
samples (subjects), flipping the sign of their difference, and recording the
absolute value of the resulting statistic (we record the absolute value
because we conduct a two-tailed test). The absolute value of the statistic
evaluated on the veridical data can then be compared to this distribution,
and the p-value is simply the proportion of null distribution values that
are smaller.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In the case of a true one-sample t-test, i.e. analyzing a single
condition rather than the difference between two conditions,
it is not clear where/how exchangeability applies; see
<a class="reference external" href="https://mailman.science.ru.nl/pipermail/fieldtrip/2008-October/001794.html">this FieldTrip discussion</a>.</p>
</div>
<p>In the case where <code class="docutils literal notranslate"><span class="pre">n_permutations</span></code> is large enough (or “all”) so
that the complete set of unique resampling exchanges can be done
(which is <span class="math notranslate nohighlight">\(2^{N_{samp}}-1\)</span> for a one-tailed and
<span class="math notranslate nohighlight">\(2^{N_{samp}-1}-1\)</span> for a two-tailed test, not counting the
veridical distribution), instead of randomly exchanging conditions
the null is formed from using all possible exchanges. This is known
as a permutation test (or exact test).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Here we have to do a bit of gymnastics to get our function to do</span>
<span class="c1"># a permutation test without correcting for multiple comparisons:</span>

<a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span><span class="o">.</span><span class="n">shape</span></a> <span class="o">=</span> <span class="p">(</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_subjects</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_src</span></a><span class="p">)</span>  <span class="c1"># flatten the array for simplicity</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">titles</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Permutation&#39;</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ts</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.zeros.html#numpy.zeros" title="numpy.zeros" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">zeros</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">width</span></a> <span class="o">*</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">width</span></a><span class="p">))</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ps</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.zeros.html#numpy.zeros" title="numpy.zeros" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">zeros</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">width</span></a> <span class="o">*</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">width</span></a><span class="p">))</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mccs</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="k">for</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ii</span></a> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_src</span></a><span class="p">):</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ts</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ii</span></a><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ps</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ii</span></a><span class="p">]</span> <span class="o">=</span> <a href="../../generated/mne.stats.permutation_t_test.html#mne.stats.permutation_t_test" title="mne.stats.permutation_t_test" class="sphx-glr-backref-module-mne-stats sphx-glr-backref-type-py-function"><span class="n">permutation_t_test</span></a><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">[:,</span> <span class="p">[</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ii</span></a><span class="p">]],</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]</span>
<span class="n">plot_t_p</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ts</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ps</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">titles</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mccs</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<img alt="Permutation" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_statistics_004.png" />
</div>
</div>
<div class="section" id="multiple-comparisons">
<h2><a class="toc-backref" href="#id13">Multiple comparisons</a><a class="headerlink" href="#multiple-comparisons" title="Permalink to this headline">¶</a></h2>
<p>So far, we have done no correction for multiple comparisons. This is
potentially problematic for these data because there are
<span class="math notranslate nohighlight">\(40 \cdot 40 = 1600\)</span> tests being performed. If we use a threshold
p &lt; 0.05 for each individual test, we would expect many voxels to be declared
significant even if there were no true effect. In other words, we would make
many <strong>type I errors</strong> (adapted from <a class="reference external" href="https://en.wikipedia.org/w/index.php?title=Type_I_and_type_II_errors#Table_of_error_types">here</a>):</p>
<table class="skinnytable docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 15%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="2" rowspan="2"></th>
<th class="head" colspan="2"><p>Null hypothesis</p></th>
</tr>
<tr class="row-even"><th class="head"><p>True</p></th>
<th class="head"><p>False</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td rowspan="2"><p>Reject</p></td>
<td><p>Yes</p></td>
<td><dl class="simple">
<dt>Type I error</dt><dd><p>False positive</p>
</dd>
</dl>
</td>
<td><dl class="simple">
<dt>Correct</dt><dd><p>True positive</p>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td><p>No</p></td>
<td><dl class="simple">
<dt>Correct</dt><dd><p>True Negative</p>
</dd>
</dl>
</td>
<td><dl class="simple">
<dt>Type II error</dt><dd><p>False negative</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
<p>To see why, consider a standard <span class="math notranslate nohighlight">\(\alpha = 0.05\)</span>.
For a single test, our probability of making a type I error is 0.05.
The probability of making at least one type I error in
<span class="math notranslate nohighlight">\(N_{\mathrm{test}}\)</span> independent tests is then given by
<span class="math notranslate nohighlight">\(1 - (1 - \alpha)^{N_{\mathrm{test}}}\)</span>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">N</span></a> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.arange.html#numpy.arange" title="numpy.arange" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">arange</span></a><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">alpha</span></a> <span class="o">=</span> <span class="mf">0.05</span>
<a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">p_type_I</span></a> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">alpha</span></a><span class="p">)</span> <span class="o">**</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">N</span></a>
<a href="https://matplotlib.org/api/_as_gen/matplotlib.figure.Figure.html#matplotlib.figure.Figure" title="matplotlib.figure.Figure" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fig</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax</span></a> <span class="o">=</span> <a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.subplots.html#matplotlib.pyplot.subplots" title="matplotlib.pyplot.subplots" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span></a><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax</span><span class="o">.</span><span class="n">scatter</span></a><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">N</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">p_type_I</span></a><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax</span><span class="o">.</span><span class="n">set</span></a><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">N</span></a><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$N_{\mathrm</span><span class="si">{test}</span><span class="s1">}$&#39;</span><span class="p">,</span>
       <span class="n">ylabel</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;Probability of at least</span><span class="se">\n</span><span class="s1">one type I error&#39;</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax</span><span class="o">.</span><span class="n">grid</span></a><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<a href="https://matplotlib.org/api/_as_gen/matplotlib.figure.Figure.html#matplotlib.figure.Figure.tight_layout" title="matplotlib.figure.Figure.tight_layout" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-method"><span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span></a><span class="p">()</span>
<a href="https://matplotlib.org/api/_as_gen/matplotlib.figure.Figure.html#matplotlib.figure.Figure.show" title="matplotlib.figure.Figure.show" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-method"><span class="n">fig</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<img alt="plot background statistics" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_statistics_005.png" />
<p>To combat this problem, several methods exist. Typically these
provide control over either one of the following two measures:</p>
<ol class="arabic">
<li><dl>
<dt><a class="reference external" href="https://en.wikipedia.org/wiki/Family-wise_error_rate">Familywise error rate (FWER)</a></dt><dd><p>The probability of making one or more type I errors:</p>
<div class="math notranslate nohighlight">
\[\mathrm{P}(N_{\mathrm{type\ I}} &gt;= 1 \mid H_0)\]</div>
</dd>
</dl>
</li>
<li><dl>
<dt><a class="reference external" href="https://en.wikipedia.org/wiki/False_discovery_rate">False discovery rate (FDR)</a></dt><dd><p>The expected proportion of rejected null hypotheses that are
actually true:</p>
<div class="math notranslate nohighlight">
\[\mathrm{E}(\frac{N_{\mathrm{type\ I}}}{N_{\mathrm{reject}}}
\mid N_{\mathrm{reject}} &gt; 0) \cdot
\mathrm{P}(N_{\mathrm{reject}} &gt; 0 \mid H_0)\]</div>
</dd>
</dl>
</li>
</ol>
<p>We cover some techniques that control FWER and FDR below.</p>
<div class="section" id="bonferroni-correction">
<h3><a class="toc-backref" href="#id14">Bonferroni correction</a><a class="headerlink" href="#bonferroni-correction" title="Permalink to this headline">¶</a></h3>
<p>Perhaps the simplest way to deal with multiple comparisons, <a class="reference external" href="https://en.wikipedia.org/wiki/Bonferroni_correction">Bonferroni
correction</a>
conservatively multiplies the p-values by the number of comparisons to
control the FWER.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">titles</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Bonferroni&#39;</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ts</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ts</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ps</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><a href="../../generated/mne.stats.bonferroni_correction.html#mne.stats.bonferroni_correction" title="mne.stats.bonferroni_correction" class="sphx-glr-backref-module-mne-stats sphx-glr-backref-type-py-function"><span class="n">bonferroni_correction</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ps</span></a><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">1</span><span class="p">])</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mccs</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plot_t_p</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ts</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ps</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">titles</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mccs</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<img alt="Bonferroni" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_statistics_006.png" />
</div>
<div class="section" id="false-discovery-rate-fdr-correction">
<h3><a class="toc-backref" href="#id15">False discovery rate (FDR) correction</a><a class="headerlink" href="#false-discovery-rate-fdr-correction" title="Permalink to this headline">¶</a></h3>
<p>Typically FDR is performed with the Benjamini-Hochberg procedure, which
is less restrictive than Bonferroni correction for large numbers of
comparisons (fewer type II errors), but provides less strict control of type
I errors.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">titles</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;FDR&#39;</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ts</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ts</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ps</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><a href="../../generated/mne.stats.fdr_correction.html#mne.stats.fdr_correction" title="mne.stats.fdr_correction" class="sphx-glr-backref-module-mne-stats sphx-glr-backref-type-py-function"><span class="n">fdr_correction</span></a><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ps</span></a><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">1</span><span class="p">])</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mccs</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plot_t_p</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ts</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ps</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">titles</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mccs</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<img alt="FDR" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_statistics_007.png" />
</div>
<div class="section" id="non-parametric-resampling-test-with-a-maximum-statistic">
<h3><a class="toc-backref" href="#id16">Non-parametric resampling test with a maximum statistic</a><a class="headerlink" href="#non-parametric-resampling-test-with-a-maximum-statistic" title="Permalink to this headline">¶</a></h3>
<p><strong>Non-parametric resampling tests</strong> can also be used to correct for multiple
comparisons. In its simplest form, we again do permutations using
exchangeability under the null hypothesis, but this time we take the
<em>maximum statistic across all voxels</em> in each permutation to form the
null distribution. The p-value for each voxel from the veridical data
is then given by the proportion of null distribution values
that were smaller.</p>
<p>This method has two important features:</p>
<ol class="arabic simple">
<li><p>It controls FWER.</p></li>
<li><p>It is non-parametric. Even though our initial test statistic
(here a 1-sample t-test) is parametric, the null
distribution for the null hypothesis rejection (the mean value across
subjects is indistinguishable from zero) is obtained by permutations.
This means that it makes no assumptions of Gaussianity
(which do hold for this example, but do not in general for some types
of processed neuroimaging data).</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">titles</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\mathbf{Perm_</span><span class="si">{max}</span><span class="s1">}$&#39;</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">out</span></a> <span class="o">=</span> <a href="../../generated/mne.stats.permutation_t_test.html#mne.stats.permutation_t_test" title="mne.stats.permutation_t_test" class="sphx-glr-backref-module-mne-stats sphx-glr-backref-type-py-function"><span class="n">permutation_t_test</span></a><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ts</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">out</span></a><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ps</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">out</span></a><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mccs</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plot_t_p</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ts</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ps</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">titles</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mccs</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<img alt="$\mathbf{Perm_{max}}$" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_statistics_008.png" />
</div>
<div class="section" id="clustering">
<h3><a class="toc-backref" href="#id17">Clustering</a><a class="headerlink" href="#clustering" title="Permalink to this headline">¶</a></h3>
<p>Each of the aforementioned multiple comparisons corrections have the
disadvantage of not fully incorporating the correlation structure of the
data, namely that points close to one another (e.g., in space or time) tend
to be correlated. However, by defining the adjacency/adjacency/neighbor
structure in our data, we can use <strong>clustering</strong> to compensate.</p>
<p>To use this, we need to rethink our null hypothesis. Instead
of thinking about a null hypothesis about means per voxel (with one
independent test per voxel), we consider a null hypothesis about sizes
of clusters in our data, which could be stated like:</p>
<blockquote>
<div><p>The distribution of spatial cluster sizes observed in two experimental
conditions are drawn from the same probability distribution.</p>
</div></blockquote>
<p>Here we only have a single condition and we contrast to zero, which can
be thought of as:</p>
<blockquote>
<div><p>The distribution of spatial cluster sizes is independent of the sign
of the data.</p>
</div></blockquote>
<p>In this case, we again do permutations with a maximum statistic, but, under
each permutation, we:</p>
<ol class="arabic simple">
<li><p>Compute the test statistic for each voxel individually.</p></li>
<li><p>Threshold the test statistic values.</p></li>
<li><p>Cluster voxels that exceed this threshold (with the same sign) based on
adjacency.</p></li>
<li><p>Retain the size of the largest cluster (measured, e.g., by a simple voxel
count, or by the sum of voxel t-values within the cluster) to build the
null distribution.</p></li>
</ol>
<p>After doing these permutations, the cluster sizes in our veridical data
are compared to this null distribution. The p-value associated with each
cluster is again given by the proportion of smaller null distribution
values. This can then be subjected to a standard p-value threshold
(e.g., p &lt; 0.05) to reject the null hypothesis (i.e., find an effect of
interest).</p>
<p>This reframing to consider <em>cluster sizes</em> rather than <em>individual means</em>
maintains the advantages of the standard non-parametric permutation
test – namely controlling FWER and making no assumptions of parametric
data distribution.
Critically, though, it also accounts for the correlation structure in the
data – which in this toy case is spatial but in general can be
multidimensional (e.g., spatio-temporal) – because the null distribution
will be derived from data in a way that preserves these correlations.</p>
<div class="sidebar">
<p class="sidebar-title">Effect size</p>
<p>For a nice description of how to compute the effect size obtained
in a cluster test, see this
<a class="reference external" href="https://mailman.science.ru.nl/pipermail/fieldtrip/2017-September/024644.html">FieldTrip mailing list discussion</a>.</p>
</div>
<p>However, there is a drawback. If a cluster significantly deviates from
the null, no further inference on the cluster (e.g., peak location) can be
made, as the entire cluster as a whole is used to reject the null.
Moreover, because the test statistic concerns the full data, the null
hypothesis (and our rejection of it) refers to the structure of the full
data. For more information, see also the comprehensive
<a class="reference external" href="http://www.fieldtriptoolbox.org/faq/how_not_to_interpret_results_from_a_cluster-based_permutation_test">FieldTrip tutorial</a>.</p>
<div class="section" id="defining-the-adjacency-matrix">
<h4><a class="toc-backref" href="#id18">Defining the adjacency matrix</a><a class="headerlink" href="#defining-the-adjacency-matrix" title="Permalink to this headline">¶</a></h4>
<p>First we need to define our adjacency (sometimes called “neighbors”) matrix.
This is a square array (or sparse matrix) of shape <code class="docutils literal notranslate"><span class="pre">(n_src,</span> <span class="pre">n_src)</span></code> that
contains zeros and ones to define which spatial points are neighbors, i.e.,
which voxels are adjacent to each other. In our case this
is quite simple, as our data are aligned on a rectangular grid.</p>
<p>Let’s pretend that our data were smaller – a 3 x 3 grid. Thinking about
each voxel as being connected to the other voxels it touches, we would
need a 9 x 9 adjacency matrix. The first row of this matrix contains the
voxels in the flattened data that the first voxel touches. Since it touches
the second element in the first row and the first element in the second row
(and is also a neighbor to itself), this would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p><a class="reference external" href="https://scikit-learn.org/stable/modules/classes.html#module-sklearn.feature_extraction" title="(in scikit-learn v0.23)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sklearn.feature_extraction</span></code></a> provides a convenient function for this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.feature_extraction.image</span> <span class="kn">import</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.feature_extraction.image.grid_to_graph.html#sklearn.feature_extraction.image.grid_to_graph" title="sklearn.feature_extraction.image.grid_to_graph" class="sphx-glr-backref-module-sklearn-feature_extraction-image sphx-glr-backref-type-py-function"><span class="n">grid_to_graph</span></a>  <span class="c1"># noqa: E402</span>
<a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mini_adjacency</span></a> <span class="o">=</span> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.feature_extraction.image.grid_to_graph.html#sklearn.feature_extraction.image.grid_to_graph" title="sklearn.feature_extraction.image.grid_to_graph" class="sphx-glr-backref-module-sklearn-feature_extraction-image sphx-glr-backref-type-py-function"><span class="n">grid_to_graph</span></a><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
<span class="k">assert</span> <a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mini_adjacency</span><span class="o">.</span><span class="n">shape</span></a> <span class="o">==</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mini_adjacency</span></a><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[1 1 0 1 0 0 0 0 0]
</pre></div>
</div>
<p>In general the adjacency between voxels can be more complex, such as
those between sensors in 3D space, or time-varying activation at brain
vertices on a cortical surface. MNE provides several convenience functions
for computing adjacency matrices (see the
<a class="reference internal" href="../../python_reference.html#api-reference-statistics"><span class="std std-ref">Statistics API</span></a>).</p>
</div>
<div class="section" id="standard-clustering">
<h4><a class="toc-backref" href="#id19">Standard clustering</a><a class="headerlink" href="#standard-clustering" title="Permalink to this headline">¶</a></h4>
<p>Here, since our data are on a grid, we can use <code class="docutils literal notranslate"><span class="pre">adjacency=None</span></code> to
trigger optimized grid-based code, and run the clustering algorithm.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">titles</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Clustering&#39;</span><span class="p">)</span>
<span class="c1"># Reshape data to what is equivalent to (n_samples, n_space, n_time)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#tuple" title="builtins.tuple" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span><span class="o">.</span><span class="n">shape</span></a> <span class="o">=</span> <span class="p">(</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_subjects</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">width</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">width</span></a><span class="p">)</span>
<span class="c1"># Compute threshold from t distribution (this is also the default)</span>
<a href="https://numpy.org/devdocs/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">threshold</span></a> <span class="o">=</span> <a href="https://scipy.github.io/devdocs/generated/scipy.stats.rv_continuous.ppf.html#scipy.stats.rv_continuous.ppf" title="scipy.stats.rv_continuous.ppf" class="sphx-glr-backref-module-scipy-stats sphx-glr-backref-type-py-method"><span class="n">stats</span><span class="o">.</span><span class="n">distributions</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span></a><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">alpha</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_subjects</span></a> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">t_clust</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">clusters</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">p_values</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">H0</span></a> <span class="o">=</span> <a href="../../generated/mne.stats.permutation_cluster_1samp_test.html#mne.stats.permutation_cluster_1samp_test" title="mne.stats.permutation_cluster_1samp_test" class="sphx-glr-backref-module-mne-stats sphx-glr-backref-type-py-function"><span class="n">permutation_cluster_1samp_test</span></a><span class="p">(</span>
    <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">threshold</span></a><span class="o">=</span><a href="https://numpy.org/devdocs/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">threshold</span></a><span class="p">,</span> <span class="n">adjacency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_permutations</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_permutations</span></a><span class="p">,</span> <span class="n">out_type</span><span class="o">=</span><span class="s1">&#39;mask&#39;</span><span class="p">)</span>
<span class="c1"># Put the cluster data in a viewable format</span>
<a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">p_clust</span></a> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ones.html#numpy.ones" title="numpy.ones" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">ones</span></a><span class="p">((</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">width</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">width</span></a><span class="p">))</span>
<span class="k">for</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">cl</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">p</span></a> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">clusters</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">p_values</span></a><span class="p">):</span>
    <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">p_clust</span></a><span class="p">[</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">cl</span></a><span class="p">]</span> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">p</span></a>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ts</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">t_clust</span></a><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ps</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">p_clust</span></a><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mccs</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plot_t_p</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ts</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ps</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">titles</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mccs</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<img alt="Clustering" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_statistics_009.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>stat_fun(H1): min=-3.195527 max=5.120434
Running initial clustering
Found 2 clusters
Permuting 510 times...

  0%|          |  : 0/510 [00:00&lt;?,       ?it/s]
 14%|#3        |  : 71/510 [00:00&lt;00:00, 2044.95it/s]
 28%|##8       |  : 145/510 [00:00&lt;00:00, 2051.65it/s]
 43%|####2     |  : 217/510 [00:00&lt;00:00, 2055.40it/s]
 57%|#####7    |  : 293/510 [00:00&lt;00:00, 2064.23it/s]
 71%|#######1  |  : 364/510 [00:00&lt;00:00, 2065.81it/s]
 86%|########5 |  : 438/510 [00:00&lt;00:00, 2071.67it/s]
100%|##########|  : 510/510 [00:00&lt;00:00, 2078.25it/s]
100%|##########|  : 510/510 [00:00&lt;00:00, 2153.96it/s]
Computing cluster p-values
Done.
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h4><a class="toc-backref" href="#id20">“Hat” variance adjustment</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>This method can also be used in this context to correct for small
variances <a class="footnote-reference brackets" href="#id6" id="id4">1</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">titles</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\mathbf{C_</span><span class="si">{hat}</span><span class="s1">}$&#39;</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/functools.html#functools.partial" title="functools.partial" class="sphx-glr-backref-module-functools sphx-glr-backref-type-py-function"><span class="n">stat_fun_hat</span></a> <span class="o">=</span> <a href="https://docs.python.org/3/library/functools.html#functools.partial" title="functools.partial" class="sphx-glr-backref-module-functools sphx-glr-backref-type-py-function"><span class="n">partial</span></a><span class="p">(</span><a href="../../generated/mne.stats.ttest_1samp_no_p.html#mne.stats.ttest_1samp_no_p" title="mne.stats.ttest_1samp_no_p" class="sphx-glr-backref-module-mne-stats sphx-glr-backref-type-py-function"><span class="n">ttest_1samp_no_p</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sigma</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sigma</span></a><span class="p">)</span>
<a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">t_hat</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">clusters</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">p_values</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">H0</span></a> <span class="o">=</span> <a href="../../generated/mne.stats.permutation_cluster_1samp_test.html#mne.stats.permutation_cluster_1samp_test" title="mne.stats.permutation_cluster_1samp_test" class="sphx-glr-backref-module-mne-stats sphx-glr-backref-type-py-function"><span class="n">permutation_cluster_1samp_test</span></a><span class="p">(</span>
    <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">threshold</span></a><span class="o">=</span><a href="https://numpy.org/devdocs/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">threshold</span></a><span class="p">,</span> <span class="n">adjacency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">out_type</span><span class="o">=</span><span class="s1">&#39;mask&#39;</span><span class="p">,</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_permutations</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_permutations</span></a><span class="p">,</span> <span class="n">stat_fun</span><span class="o">=</span><a href="https://docs.python.org/3/library/functools.html#functools.partial" title="functools.partial" class="sphx-glr-backref-module-functools sphx-glr-backref-type-py-function"><span class="n">stat_fun_hat</span></a><span class="p">,</span> <span class="n">buffer_size</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">p_hat</span></a> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ones.html#numpy.ones" title="numpy.ones" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">ones</span></a><span class="p">((</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">width</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">width</span></a><span class="p">))</span>
<span class="k">for</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">cl</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">p</span></a> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">clusters</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">p_values</span></a><span class="p">):</span>
    <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">p_hat</span></a><span class="p">[</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">cl</span></a><span class="p">]</span> <span class="o">=</span> <a href="https://numpy.org/devdocs/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">p</span></a>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ts</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">t_hat</span></a><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ps</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">p_hat</span></a><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mccs</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plot_t_p</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ts</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ps</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">titles</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mccs</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<img alt="$\mathbf{C_{hat}}$" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_statistics_010.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>stat_fun(H1): min=-0.043603 max=3.127369
Running initial clustering
Found 1 clusters
Permuting 510 times...

  0%|          |  : 0/510 [00:00&lt;?,       ?it/s]
 35%|###4      |  : 178/510 [00:00&lt;00:00, 5195.63it/s]
 70%|######9   |  : 355/510 [00:00&lt;00:00, 5197.38it/s]
100%|##########|  : 510/510 [00:00&lt;00:00, 5185.85it/s]
100%|##########|  : 510/510 [00:00&lt;00:00, 5119.33it/s]
Computing cluster p-values
Done.
</pre></div>
</div>
</div>
<div class="section" id="threshold-free-cluster-enhancement-tfce">
<span id="tfce-example"></span><h4><a class="toc-backref" href="#id21">Threshold-free cluster enhancement (TFCE)</a><a class="headerlink" href="#threshold-free-cluster-enhancement-tfce" title="Permalink to this headline">¶</a></h4>
<p>TFCE eliminates the free parameter initial <code class="docutils literal notranslate"><span class="pre">threshold</span></code> value that
determines which points are included in clustering by approximating
a continuous integration across possible threshold values with a standard
<a class="reference external" href="https://en.wikipedia.org/wiki/Riemann_sum">Riemann sum</a> <a class="footnote-reference brackets" href="#id7" id="id5">2</a>.
This requires giving a starting threshold <code class="docutils literal notranslate"><span class="pre">start</span></code> and a step
size <code class="docutils literal notranslate"><span class="pre">step</span></code>, which in MNE is supplied as a dict.
The smaller the <code class="docutils literal notranslate"><span class="pre">step</span></code> and closer to 0 the <code class="docutils literal notranslate"><span class="pre">start</span></code> value,
the better the approximation, but the longer it takes.</p>
<p>A significant advantage of TFCE is that, rather than modifying the
statistical null hypothesis under test (from one about individual voxels
to one about the distribution of clusters in the data), it modifies the <em>data
under test</em> while still controlling for multiple comparisons.
The statistical test is then done at the level of individual voxels rather
than clusters. This allows for evaluation of each point
independently for significance rather than only as cluster groups.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">titles</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\mathbf{C_</span><span class="si">{TFCE}</span><span class="s1">}$&#39;</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">threshold_tfce</span></a> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">t_tfce</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">_</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">p_tfce</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">H0</span></a> <span class="o">=</span> <a href="../../generated/mne.stats.permutation_cluster_1samp_test.html#mne.stats.permutation_cluster_1samp_test" title="mne.stats.permutation_cluster_1samp_test" class="sphx-glr-backref-module-mne-stats sphx-glr-backref-type-py-function"><span class="n">permutation_cluster_1samp_test</span></a><span class="p">(</span>
    <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">threshold</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">threshold_tfce</span></a><span class="p">,</span> <span class="n">adjacency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_permutations</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_permutations</span></a><span class="p">,</span> <span class="n">out_type</span><span class="o">=</span><span class="s1">&#39;mask&#39;</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ts</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">t_tfce</span></a><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ps</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">p_tfce</span></a><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mccs</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plot_t_p</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ts</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ps</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">titles</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mccs</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<img alt="$\mathbf{C_{TFCE}}$" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_statistics_011.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>stat_fun(H1): min=-3.195527 max=5.120434
Running initial clustering
Using 26 thresholds from 0.00 to 5.00 for TFCE computation (h_power=2.00, e_power=0.50)
Found 1600 clusters
Permuting 510 times...

  0%|          |  : 0/510 [00:00&lt;?,       ?it/s]
  1%|          |  : 3/510 [00:00&lt;00:05,   87.75it/s]
  1%|1         |  : 7/510 [00:00&lt;00:05,   88.90it/s]
  2%|2         |  : 11/510 [00:00&lt;00:05,   90.02it/s]
  3%|3         |  : 16/510 [00:00&lt;00:05,   91.81it/s]
  4%|3         |  : 20/510 [00:00&lt;00:05,   92.84it/s]
  5%|4         |  : 24/510 [00:00&lt;00:05,   93.84it/s]
  5%|5         |  : 28/510 [00:00&lt;00:05,   94.83it/s]
  6%|6         |  : 32/510 [00:00&lt;00:04,   95.77it/s]
  7%|7         |  : 37/510 [00:00&lt;00:04,   97.49it/s]
  8%|8         |  : 41/510 [00:00&lt;00:04,   98.35it/s]
  9%|8         |  : 45/510 [00:00&lt;00:04,   99.17it/s]
 10%|9         |  : 49/510 [00:00&lt;00:04,   99.98it/s]
 10%|#         |  : 53/510 [00:00&lt;00:04,  100.75it/s]
 11%|#1        |  : 57/510 [00:00&lt;00:04,  101.50it/s]
 12%|#1        |  : 61/510 [00:00&lt;00:04,  102.23it/s]
 13%|#2        |  : 66/510 [00:00&lt;00:04,  103.83it/s]
 14%|#3        |  : 70/510 [00:00&lt;00:04,  104.47it/s]
 15%|#4        |  : 75/510 [00:00&lt;00:04,  106.02it/s]
 15%|#5        |  : 79/510 [00:00&lt;00:04,  106.56it/s]
 16%|#6        |  : 83/510 [00:00&lt;00:03,  107.09it/s]
 17%|#7        |  : 88/510 [00:00&lt;00:03,  108.56it/s]
 18%|#8        |  : 92/510 [00:00&lt;00:03,  109.00it/s]
 19%|#8        |  : 96/510 [00:00&lt;00:03,  109.43it/s]
 20%|#9        |  : 101/510 [00:00&lt;00:03,  110.87it/s]
 21%|##        |  : 105/510 [00:00&lt;00:03,  111.23it/s]
 21%|##1       |  : 109/510 [00:00&lt;00:03,  111.55it/s]
 22%|##2       |  : 113/510 [00:00&lt;00:03,  111.87it/s]
 23%|##2       |  : 117/510 [00:00&lt;00:03,  112.17it/s]
 24%|##3       |  : 121/510 [00:00&lt;00:03,  112.46it/s]
 25%|##4       |  : 126/510 [00:01&lt;00:03,  113.82it/s]
 25%|##5       |  : 130/510 [00:01&lt;00:03,  114.04it/s]
 26%|##6       |  : 135/510 [00:01&lt;00:03,  115.35it/s]
 27%|##7       |  : 139/510 [00:01&lt;00:03,  115.50it/s]
 28%|##8       |  : 143/510 [00:01&lt;00:03,  115.63it/s]
 29%|##9       |  : 148/510 [00:01&lt;00:03,  116.89it/s]
 30%|##9       |  : 152/510 [00:01&lt;00:03,  116.97it/s]
 31%|###       |  : 156/510 [00:01&lt;00:03,  117.03it/s]
 31%|###1      |  : 160/510 [00:01&lt;00:02,  117.10it/s]
 32%|###2      |  : 164/510 [00:01&lt;00:02,  117.14it/s]
 33%|###2      |  : 168/510 [00:01&lt;00:02,  117.20it/s]
 34%|###3      |  : 172/510 [00:01&lt;00:02,  117.26it/s]
 35%|###4      |  : 176/510 [00:01&lt;00:02,  117.30it/s]
 35%|###5      |  : 180/510 [00:01&lt;00:02,  117.35it/s]
 36%|###6      |  : 185/510 [00:01&lt;00:02,  118.58it/s]
 37%|###6      |  : 188/510 [00:01&lt;00:02,  116.62it/s]
 38%|###7      |  : 193/510 [00:01&lt;00:02,  117.85it/s]
 39%|###8      |  : 198/510 [00:01&lt;00:02,  119.04it/s]
 40%|###9      |  : 202/510 [00:01&lt;00:02,  119.00it/s]
 40%|####      |  : 206/510 [00:01&lt;00:02,  118.95it/s]
 41%|####1     |  : 210/510 [00:01&lt;00:02,  118.93it/s]
 42%|####2     |  : 215/510 [00:01&lt;00:02,  120.09it/s]
 43%|####2     |  : 219/510 [00:01&lt;00:02,  120.00it/s]
 44%|####3     |  : 223/510 [00:01&lt;00:02,  119.92it/s]
 45%|####4     |  : 227/510 [00:01&lt;00:02,  119.83it/s]
 45%|####5     |  : 231/510 [00:01&lt;00:02,  119.55it/s]
 46%|####6     |  : 235/510 [00:01&lt;00:02,  119.49it/s]
 47%|####6     |  : 239/510 [00:01&lt;00:02,  119.42it/s]
 48%|####7     |  : 243/510 [00:01&lt;00:02,  119.37it/s]
 48%|####8     |  : 247/510 [00:01&lt;00:02,  119.30it/s]
 49%|####9     |  : 251/510 [00:02&lt;00:02,  119.25it/s]
 50%|#####     |  : 255/510 [00:02&lt;00:02,  119.20it/s]
 51%|#####     |  : 259/510 [00:02&lt;00:02,  119.16it/s]
 52%|#####1    |  : 263/510 [00:02&lt;00:02,  119.11it/s]
 52%|#####2    |  : 267/510 [00:02&lt;00:02,  119.07it/s]
 53%|#####3    |  : 271/510 [00:02&lt;00:02,  119.02it/s]
 54%|#####3    |  : 275/510 [00:02&lt;00:01,  119.00it/s]
 55%|#####4    |  : 279/510 [00:02&lt;00:01,  118.97it/s]
 55%|#####5    |  : 283/510 [00:02&lt;00:01,  118.94it/s]
 56%|#####6    |  : 288/510 [00:02&lt;00:01,  120.10it/s]
 57%|#####7    |  : 292/510 [00:02&lt;00:01,  120.00it/s]
 58%|#####8    |  : 296/510 [00:02&lt;00:01,  119.92it/s]
 59%|#####8    |  : 300/510 [00:02&lt;00:01,  119.85it/s]
 60%|#####9    |  : 304/510 [00:02&lt;00:01,  119.77it/s]
 60%|######    |  : 307/510 [00:02&lt;00:01,  117.69it/s]
 61%|######    |  : 309/510 [00:02&lt;00:01,  112.14it/s]
 61%|######1   |  : 312/510 [00:02&lt;00:01,  110.66it/s]
 62%|######1   |  : 315/510 [00:02&lt;00:01,  109.31it/s]
 62%|######2   |  : 318/510 [00:02&lt;00:01,  108.06it/s]
 63%|######3   |  : 322/510 [00:02&lt;00:01,  108.53it/s]
 64%|######3   |  : 325/510 [00:02&lt;00:01,  107.35it/s]
 65%|######4   |  : 329/510 [00:02&lt;00:01,  107.85it/s]
 65%|######5   |  : 333/510 [00:02&lt;00:01,  108.32it/s]
 66%|######6   |  : 337/510 [00:02&lt;00:01,  108.73it/s]
 67%|######6   |  : 340/510 [00:02&lt;00:01,  107.52it/s]
 67%|######7   |  : 344/510 [00:02&lt;00:01,  108.01it/s]
 68%|######8   |  : 348/510 [00:02&lt;00:01,  108.49it/s]
 69%|######8   |  : 351/510 [00:02&lt;00:01,  107.29it/s]
 70%|######9   |  : 355/510 [00:02&lt;00:01,  107.78it/s]
 70%|#######   |  : 359/510 [00:03&lt;00:01,  108.25it/s]
 71%|#######   |  : 362/510 [00:03&lt;00:01,  107.08it/s]
 72%|#######1  |  : 366/510 [00:03&lt;00:01,  107.59it/s]
 73%|#######2  |  : 370/510 [00:03&lt;00:01,  108.08it/s]
 73%|#######3  |  : 374/510 [00:03&lt;00:01,  108.45it/s]
 74%|#######3  |  : 377/510 [00:03&lt;00:01,  107.24it/s]
 75%|#######4  |  : 381/510 [00:03&lt;00:01,  107.75it/s]
 75%|#######5  |  : 385/510 [00:03&lt;00:01,  108.23it/s]
 76%|#######6  |  : 388/510 [00:03&lt;00:01,  107.06it/s]
 77%|#######6  |  : 392/510 [00:03&lt;00:01,  107.57it/s]
 78%|#######7  |  : 396/510 [00:03&lt;00:01,  108.05it/s]
 78%|#######8  |  : 399/510 [00:03&lt;00:01,  106.87it/s]
 79%|#######9  |  : 403/510 [00:03&lt;00:00,  107.38it/s]
 80%|#######9  |  : 407/510 [00:03&lt;00:00,  107.85it/s]
 81%|########  |  : 411/510 [00:03&lt;00:00,  108.34it/s]
 81%|########1 |  : 415/510 [00:03&lt;00:00,  108.79it/s]
 82%|########2 |  : 419/510 [00:03&lt;00:00,  109.22it/s]
 83%|########2 |  : 423/510 [00:03&lt;00:00,  109.63it/s]
 84%|########3 |  : 427/510 [00:03&lt;00:00,  110.02it/s]
 85%|########4 |  : 431/510 [00:03&lt;00:00,  110.38it/s]
 85%|########5 |  : 435/510 [00:03&lt;00:00,  110.75it/s]
 86%|########6 |  : 439/510 [00:03&lt;00:00,  111.09it/s]
 87%|########6 |  : 443/510 [00:03&lt;00:00,  111.43it/s]
 87%|########7 |  : 446/510 [00:03&lt;00:00,  110.02it/s]
 88%|########8 |  : 450/510 [00:03&lt;00:00,  110.40it/s]
 89%|########9 |  : 454/510 [00:03&lt;00:00,  110.78it/s]
 90%|########9 |  : 458/510 [00:03&lt;00:00,  111.13it/s]
 91%|######### |  : 462/510 [00:03&lt;00:00,  111.47it/s]
 91%|#########1|  : 466/510 [00:03&lt;00:00,  111.79it/s]
 92%|#########2|  : 470/510 [00:03&lt;00:00,  112.10it/s]
 93%|#########2|  : 474/510 [00:04&lt;00:00,  112.40it/s]
 93%|#########3|  : 476/510 [00:04&lt;00:00,  107.54it/s]
 94%|#########3|  : 479/510 [00:04&lt;00:00,  106.41it/s]
 95%|#########4|  : 482/510 [00:04&lt;00:00,  105.37it/s]
 95%|#########5|  : 486/510 [00:04&lt;00:00,  105.95it/s]
 96%|#########6|  : 491/510 [00:04&lt;00:00,  107.48it/s]
 97%|#########6|  : 494/510 [00:04&lt;00:00,  106.35it/s]
 98%|#########7|  : 498/510 [00:04&lt;00:00,  106.89it/s]
 98%|#########8|  : 502/510 [00:04&lt;00:00,  107.41it/s]
 99%|#########9|  : 506/510 [00:04&lt;00:00,  107.90it/s]
100%|##########|  : 510/510 [00:04&lt;00:00,  108.49it/s]
100%|##########|  : 510/510 [00:04&lt;00:00,  116.79it/s]
Computing cluster p-values
Done.
</pre></div>
</div>
<p>We can also combine TFCE and the “hat” correction:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">titles</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\mathbf{C_{hat,TFCE}}$&#39;</span><span class="p">)</span>
<a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">t_tfce_hat</span></a><span class="p">,</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">_</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">p_tfce_hat</span></a><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">H0</span></a> <span class="o">=</span> <a href="../../generated/mne.stats.permutation_cluster_1samp_test.html#mne.stats.permutation_cluster_1samp_test" title="mne.stats.permutation_cluster_1samp_test" class="sphx-glr-backref-module-mne-stats sphx-glr-backref-type-py-function"><span class="n">permutation_cluster_1samp_test</span></a><span class="p">(</span>
    <a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">X</span></a><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <a href="https://numpy.org/devdocs/reference/arrays.scalars.html#numpy.float64" title="numpy.float64" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-attribute"><span class="n">threshold</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">threshold_tfce</span></a><span class="p">,</span> <span class="n">adjacency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">out_type</span><span class="o">=</span><span class="s1">&#39;mask&#39;</span><span class="p">,</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_permutations</span></a><span class="o">=</span><a href="https://docs.python.org/3/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_permutations</span></a><span class="p">,</span> <span class="n">stat_fun</span><span class="o">=</span><a href="https://docs.python.org/3/library/functools.html#functools.partial" title="functools.partial" class="sphx-glr-backref-module-functools sphx-glr-backref-type-py-function"><span class="n">stat_fun_hat</span></a><span class="p">,</span> <span class="n">buffer_size</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ts</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">t_tfce_hat</span></a><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ps</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><a href="https://numpy.org/devdocs/reference/generated/numpy.ndarray.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">p_tfce_hat</span></a><span class="p">)</span>
<a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mccs</span></a><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plot_t_p</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ts</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ps</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">titles</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mccs</span></a><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<img alt="$\mathbf{C_{hat,TFCE}}$" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_statistics_012.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>stat_fun(H1): min=-0.043603 max=3.127369
Running initial clustering
Using 16 thresholds from 0.00 to 3.00 for TFCE computation (h_power=2.00, e_power=0.50)
Found 1600 clusters
Permuting 510 times...

  0%|          |  : 0/510 [00:00&lt;?,       ?it/s]
  1%|1         |  : 6/510 [00:00&lt;00:02,  174.68it/s]
  3%|2         |  : 14/510 [00:00&lt;00:02,  177.00it/s]
  4%|4         |  : 22/510 [00:00&lt;00:02,  179.26it/s]
  6%|5         |  : 30/510 [00:00&lt;00:02,  181.46it/s]
  7%|7         |  : 37/510 [00:00&lt;00:02,  182.58it/s]
  9%|8         |  : 45/510 [00:00&lt;00:02,  184.70it/s]
 10%|#         |  : 53/510 [00:00&lt;00:02,  186.75it/s]
 12%|#1        |  : 60/510 [00:00&lt;00:02,  187.63it/s]
 13%|#3        |  : 67/510 [00:00&lt;00:02,  188.52it/s]
 15%|#4        |  : 74/510 [00:00&lt;00:02,  189.36it/s]
 16%|#5        |  : 81/510 [00:00&lt;00:02,  190.18it/s]
 17%|#7        |  : 89/510 [00:00&lt;00:02,  192.06it/s]
 19%|#8        |  : 96/510 [00:00&lt;00:02,  192.77it/s]
 20%|##        |  : 103/510 [00:00&lt;00:02,  193.44it/s]
 22%|##1       |  : 110/510 [00:00&lt;00:02,  194.09it/s]
 23%|##3       |  : 118/510 [00:00&lt;00:02,  195.86it/s]
 25%|##4       |  : 125/510 [00:00&lt;00:01,  196.39it/s]
 26%|##5       |  : 132/510 [00:00&lt;00:01,  196.91it/s]
 27%|##7       |  : 140/510 [00:00&lt;00:01,  198.57it/s]
 29%|##8       |  : 147/510 [00:00&lt;00:01,  198.98it/s]
 30%|###       |  : 154/510 [00:00&lt;00:01,  199.38it/s]
 32%|###1      |  : 161/510 [00:00&lt;00:01,  199.76it/s]
 33%|###2      |  : 168/510 [00:00&lt;00:01,  200.12it/s]
 35%|###4      |  : 176/510 [00:00&lt;00:01,  201.69it/s]
 36%|###6      |  : 184/510 [00:00&lt;00:01,  203.20it/s]
 37%|###7      |  : 191/510 [00:00&lt;00:01,  203.40it/s]
 39%|###9      |  : 199/510 [00:00&lt;00:01,  204.81it/s]
 40%|####      |  : 205/510 [00:00&lt;00:01,  203.24it/s]
 42%|####1     |  : 213/510 [00:00&lt;00:01,  204.68it/s]
 43%|####3     |  : 220/510 [00:01&lt;00:01,  204.79it/s]
 45%|####4     |  : 228/510 [00:01&lt;00:01,  206.19it/s]
 46%|####6     |  : 235/510 [00:01&lt;00:01,  206.24it/s]
 47%|####7     |  : 242/510 [00:01&lt;00:01,  206.29it/s]
 49%|####8     |  : 249/510 [00:01&lt;00:01,  206.33it/s]
 50%|#####     |  : 256/510 [00:01&lt;00:01,  206.38it/s]
 52%|#####1    |  : 264/510 [00:01&lt;00:01,  207.70it/s]
 53%|#####3    |  : 271/510 [00:01&lt;00:01,  207.69it/s]
 55%|#####4    |  : 279/510 [00:01&lt;00:01,  208.98it/s]
 56%|#####6    |  : 286/510 [00:01&lt;00:01,  208.90it/s]
 57%|#####7    |  : 293/510 [00:01&lt;00:01,  208.80it/s]
 59%|#####9    |  : 301/510 [00:01&lt;00:00,  210.04it/s]
 60%|######    |  : 308/510 [00:01&lt;00:00,  209.72it/s]
 62%|######1   |  : 314/510 [00:01&lt;00:00,  207.82it/s]
 63%|######2   |  : 320/510 [00:01&lt;00:00,  206.06it/s]
 64%|######4   |  : 327/510 [00:01&lt;00:00,  206.10it/s]
 65%|######5   |  : 334/510 [00:01&lt;00:00,  206.12it/s]
 67%|######6   |  : 340/510 [00:01&lt;00:00,  204.48it/s]
 68%|######8   |  : 347/510 [00:01&lt;00:00,  204.61it/s]
 70%|######9   |  : 355/510 [00:01&lt;00:00,  205.99it/s]
 71%|#######   |  : 361/510 [00:01&lt;00:00,  204.34it/s]
 72%|#######2  |  : 368/510 [00:01&lt;00:00,  204.46it/s]
 73%|#######3  |  : 374/510 [00:01&lt;00:00,  202.93it/s]
 75%|#######4  |  : 381/510 [00:01&lt;00:00,  203.14it/s]
 76%|#######6  |  : 388/510 [00:01&lt;00:00,  203.32it/s]
 78%|#######7  |  : 396/510 [00:01&lt;00:00,  204.72it/s]
 79%|#######8  |  : 401/510 [00:01&lt;00:00,  200.87it/s]
 80%|#######9  |  : 407/510 [00:01&lt;00:00,  199.57it/s]
 82%|########1 |  : 416/510 [00:01&lt;00:00,  202.10it/s]
 83%|########3 |  : 424/510 [00:01&lt;00:00,  203.60it/s]
 85%|########4 |  : 432/510 [00:02&lt;00:00,  205.03it/s]
 86%|########6 |  : 439/510 [00:02&lt;00:00,  205.12it/s]
 88%|########7 |  : 447/510 [00:02&lt;00:00,  206.45it/s]
 89%|########9 |  : 455/510 [00:02&lt;00:00,  207.79it/s]
 91%|######### |  : 463/510 [00:02&lt;00:00,  209.07it/s]
 92%|#########2|  : 471/510 [00:02&lt;00:00,  210.30it/s]
 94%|#########3|  : 479/510 [00:02&lt;00:00,  211.48it/s]
 95%|#########5|  : 487/510 [00:02&lt;00:00,  212.62it/s]
 97%|#########7|  : 495/510 [00:02&lt;00:00,  213.68it/s]
 99%|#########8|  : 503/510 [00:02&lt;00:00,  214.73it/s]
100%|##########|  : 510/510 [00:02&lt;00:00,  216.67it/s]
100%|##########|  : 510/510 [00:02&lt;00:00,  216.01it/s]
Computing cluster p-values
Done.
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="visualize-and-compare-methods">
<h2><a class="toc-backref" href="#id22">Visualize and compare methods</a><a class="headerlink" href="#visualize-and-compare-methods" title="Permalink to this headline">¶</a></h2>
<p>Let’s take a look at these statistics. The top row shows each test statistic,
and the bottom shows p-values for various statistical tests, with the ones
with proper control over FWER or FDR with bold titles.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://matplotlib.org/api/_as_gen/matplotlib.figure.Figure.html#matplotlib.figure.Figure" title="matplotlib.figure.Figure" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">fig</span></a> <span class="o">=</span> <a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.figure.html#matplotlib.pyplot.figure" title="matplotlib.pyplot.figure" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span></a><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ts</span></a><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">titles</span></a><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ps</span></a><span class="p">)</span>
<span class="k">for</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ii</span></a> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ts</span></a><span class="p">)):</span>
    <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax</span></a> <span class="o">=</span> <span class="p">[</span><a href="https://matplotlib.org/api/_as_gen/matplotlib.figure.Figure.html#matplotlib.figure.Figure.add_subplot" title="matplotlib.figure.Figure.add_subplot" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-method"><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span></a><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ii</span></a> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">),</span>
          <a href="https://matplotlib.org/api/_as_gen/matplotlib.figure.Figure.html#matplotlib.figure.Figure.add_subplot" title="matplotlib.figure.Figure.add_subplot" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-method"><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span></a><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span> <span class="o">+</span> <a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ii</span></a><span class="p">)]</span>
    <span class="n">plot_t_p</span><span class="p">(</span><a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ts</span></a><span class="p">[</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ii</span></a><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ps</span></a><span class="p">[</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ii</span></a><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">titles</span></a><span class="p">[</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ii</span></a><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">mccs</span></a><span class="p">[</span><a href="https://docs.python.org/3/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ii</span></a><span class="p">],</span> <a href="https://docs.python.org/3/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ax</span></a><span class="p">)</span>
<a href="https://matplotlib.org/api/_as_gen/matplotlib.figure.Figure.html#matplotlib.figure.Figure.tight_layout" title="matplotlib.figure.Figure.tight_layout" class="sphx-glr-backref-module-matplotlib-figure sphx-glr-backref-type-py-method"><span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span></a><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">w_pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.show.html#matplotlib.pyplot.show" title="matplotlib.pyplot.show" class="sphx-glr-backref-module-matplotlib-pyplot sphx-glr-backref-type-py-function"><span class="n">plt</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<img alt="t, $\mathrm{t_{hat}}$, Permutation, Bonferroni, FDR, $\mathbf{Perm_{max}}$, Clustering, $\mathbf{C_{hat}}$, $\mathbf{C_{TFCE}}$, $\mathbf{C_{hat,TFCE}}$" class="sphx-glr-single-img" src="../../_images/sphx_glr_plot_background_statistics_013.png" />
<p>The first three columns show the parametric and non-parametric statistics
that are not corrected for multiple comparisons:</p>
<ul class="simple">
<li><p>Mass univariate <strong>t-tests</strong> result in jagged edges.</p></li>
<li><p><strong>“Hat” variance correction</strong> of the t-tests produces less peaky edges,
correcting for sharpness in the statistic driven by low-variance voxels.</p></li>
<li><p><strong>Non-parametric resampling tests</strong> are very similar to t-tests. This is to
be expected: the data are drawn from a Gaussian distribution, and thus
satisfy parametric assumptions.</p></li>
</ul>
<p>The next three columns show multiple comparison corrections of the
mass univariate tests (parametric and non-parametric). These
too conservatively correct for multiple comparisons because neighboring
voxels in our data are correlated:</p>
<ul class="simple">
<li><p><strong>Bonferroni correction</strong> eliminates any significant activity.</p></li>
<li><p><strong>FDR correction</strong> is less conservative than Bonferroni.</p></li>
<li><p>A <strong>permutation test with a maximum statistic</strong> also eliminates any
significant activity.</p></li>
</ul>
<p>The final four columns show the non-parametric cluster-based permutation
tests with a maximum statistic:</p>
<ul class="simple">
<li><p><strong>Standard clustering</strong> identifies the correct region. However, the whole
area must be declared significant, so no peak analysis can be done.
Also, the peak is broad.</p></li>
<li><p><strong>Clustering with “hat” variance adjustment</strong> tightens the estimate of
significant activity.</p></li>
<li><p><strong>Clustering with TFCE</strong> allows analyzing each significant point
independently, but still has a broadened estimate.</p></li>
<li><p><strong>Clustering with TFCE and “hat” variance adjustment</strong> tightens the area
declared significant (again FWER corrected).</p></li>
</ul>
</div>
<div class="section" id="statistical-functions-in-mne">
<h2><a class="toc-backref" href="#id23">Statistical functions in MNE</a><a class="headerlink" href="#statistical-functions-in-mne" title="Permalink to this headline">¶</a></h2>
<p>The complete listing of statistical functions provided by MNE are in
the <a class="reference internal" href="../../python_reference.html#api-reference-statistics"><span class="std std-ref">Statistics API list</span></a>, but we will give
a brief overview here.</p>
<p>MNE provides several convenience parametric testing functions that can be
used in conjunction with the non-parametric clustering methods. However,
the set of functions we provide is not meant to be exhaustive.</p>
<p>If the univariate statistical contrast of interest is not listed here
(e.g., interaction term in an unbalanced ANOVA), consider checking out the
<a class="reference external" href="https://www.statsmodels.org/dev/about.html#module-statsmodels" title="(in statsmodels vv0.13.0.dev0 (+133))"><code class="xref py py-mod docutils literal notranslate"><span class="pre">statsmodels</span></code></a> package. It offers many functions for computing
statistical contrasts, e.g., <a class="reference external" href="https://www.statsmodels.org/dev/generated/statsmodels.stats.anova.anova_lm.html#statsmodels.stats.anova.anova_lm" title="(in statsmodels vv0.13.0.dev0 (+133))"><code class="xref py py-func docutils literal notranslate"><span class="pre">statsmodels.stats.anova.anova_lm()</span></code></a>.
To use these functions in clustering:</p>
<ol class="arabic simple">
<li><p>Determine which test statistic (e.g., t-value, F-value) you would use
in a univariate context to compute your contrast of interest. In other
words, if there were only a single output such as reaction times, what
test statistic might you compute on the data?</p></li>
<li><p>Wrap the call to that function within a function that takes an input of
the same shape that is expected by your clustering function,
and returns an array of the same shape without the “samples” dimension
(e.g., <a class="reference internal" href="../../generated/mne.stats.permutation_cluster_1samp_test.html#mne.stats.permutation_cluster_1samp_test" title="mne.stats.permutation_cluster_1samp_test"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.stats.permutation_cluster_1samp_test()</span></code></a> takes an array
of shape <code class="docutils literal notranslate"><span class="pre">(n_samples,</span> <span class="pre">p,</span> <span class="pre">q)</span></code> and returns an array of shape <code class="docutils literal notranslate"><span class="pre">(p,</span> <span class="pre">q)</span></code>).</p></li>
<li><p>Pass this wrapped function to the <code class="docutils literal notranslate"><span class="pre">stat_fun</span></code> argument to the clustering
function.</p></li>
<li><p>Set an appropriate <code class="docutils literal notranslate"><span class="pre">threshold</span></code> value (float or dict) based on the
values your statistical contrast function returns.</p></li>
</ol>
<div class="section" id="parametric-methods-provided-by-mne">
<h3><a class="toc-backref" href="#id24">Parametric methods provided by MNE</a><a class="headerlink" href="#parametric-methods-provided-by-mne" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><dl class="simple">
<dt><a class="reference internal" href="../../generated/mne.stats.ttest_1samp_no_p.html#mne.stats.ttest_1samp_no_p" title="mne.stats.ttest_1samp_no_p"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.stats.ttest_1samp_no_p()</span></code></a></dt><dd><p>Paired t-test, optionally with hat adjustment.
This is used by default for contrast enhancement in paired cluster tests.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference internal" href="../../generated/mne.stats.f_oneway.html#mne.stats.f_oneway" title="mne.stats.f_oneway"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.stats.f_oneway()</span></code></a></dt><dd><p>One-way ANOVA for independent samples.
This can be used to compute various F-contrasts. It is used by default
for contrast enhancement in non-paired cluster tests.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference internal" href="../../generated/mne.stats.f_mway_rm.html#mne.stats.f_mway_rm" title="mne.stats.f_mway_rm"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.stats.f_mway_rm()</span></code></a></dt><dd><p>M-way ANOVA for repeated measures and balanced designs.
This returns F-statistics and p-values. The associated helper function
<a class="reference internal" href="../../generated/mne.stats.f_threshold_mway_rm.html#mne.stats.f_threshold_mway_rm" title="mne.stats.f_threshold_mway_rm"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.stats.f_threshold_mway_rm()</span></code></a> can be used to determine the
F-threshold at a given significance level.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference internal" href="../../generated/mne.stats.linear_regression.html#mne.stats.linear_regression" title="mne.stats.linear_regression"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.stats.linear_regression()</span></code></a></dt><dd><p>Compute ordinary least square regressions on multiple targets, e.g.,
sensors, time points across trials (samples).
For each regressor it returns the beta value, t-statistic, and
uncorrected p-value. While it can be used as a test, it is
particularly useful to compute weighted averages or deal with
continuous predictors.</p>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="non-parametric-methods">
<h3><a class="toc-backref" href="#id25">Non-parametric methods</a><a class="headerlink" href="#non-parametric-methods" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><dl class="simple">
<dt><a class="reference internal" href="../../generated/mne.stats.permutation_cluster_test.html#mne.stats.permutation_cluster_test" title="mne.stats.permutation_cluster_test"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.stats.permutation_cluster_test()</span></code></a></dt><dd><p>Unpaired contrasts with clustering.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference internal" href="../../generated/mne.stats.spatio_temporal_cluster_test.html#mne.stats.spatio_temporal_cluster_test" title="mne.stats.spatio_temporal_cluster_test"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.stats.spatio_temporal_cluster_test()</span></code></a></dt><dd><p>Unpaired contrasts with spatio-temporal clustering.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference internal" href="../../generated/mne.stats.permutation_t_test.html#mne.stats.permutation_t_test" title="mne.stats.permutation_t_test"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.stats.permutation_t_test()</span></code></a></dt><dd><p>Paired contrast with no clustering.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference internal" href="../../generated/mne.stats.permutation_cluster_1samp_test.html#mne.stats.permutation_cluster_1samp_test" title="mne.stats.permutation_cluster_1samp_test"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.stats.permutation_cluster_1samp_test()</span></code></a></dt><dd><p>Paired contrasts with clustering.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference internal" href="../../generated/mne.stats.spatio_temporal_cluster_1samp_test.html#mne.stats.spatio_temporal_cluster_1samp_test" title="mne.stats.spatio_temporal_cluster_1samp_test"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.stats.spatio_temporal_cluster_1samp_test()</span></code></a></dt><dd><p>Paired contrasts with spatio-temporal clustering.</p>
</dd>
</dl>
</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In most MNE functions, data has shape
<code class="docutils literal notranslate"><span class="pre">(...,</span> <span class="pre">n_space,</span> <span class="pre">n_time)</span></code>, where the spatial dimension can
be e.g. sensors or source vertices. But for our spatio-temporal
clustering functions, the spatial dimensions need to be <strong>last</strong>
for computational efficiency reasons. For example, for
<a class="reference internal" href="../../generated/mne.stats.spatio_temporal_cluster_1samp_test.html#mne.stats.spatio_temporal_cluster_1samp_test" title="mne.stats.spatio_temporal_cluster_1samp_test"><code class="xref py py-func docutils literal notranslate"><span class="pre">mne.stats.spatio_temporal_cluster_1samp_test()</span></code></a>, <code class="docutils literal notranslate"><span class="pre">X</span></code>
needs to be of shape <code class="docutils literal notranslate"><span class="pre">(n_samples,</span> <span class="pre">n_time,</span> <span class="pre">n_space)</span></code>. You can
use <a class="reference external" href="https://numpy.org/devdocs/reference/generated/numpy.transpose.html#numpy.transpose" title="(in NumPy v1.21.dev0)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.transpose()</span></code></a> to transpose axes if necessary.</p>
</div>
</div>
</div>
<div class="section" id="references">
<h2><a class="toc-backref" href="#id26">References</a><a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<dl class="footnote brackets">
<dt class="label" id="id6"><span class="brackets">1</span><span class="fn-backref">(<a href="#id1">1</a>,<a href="#id2">2</a>,<a href="#id4">3</a>)</span></dt>
<dd><p>Ridgway et al. 2012, “The problem of low variance voxels in
statistical parametric mapping; a new hat avoids a ‘haircut’”,
NeuroImage. 2012 Feb 1;59(3):2131-41.</p>
</dd>
<dt class="label" id="id7"><span class="brackets"><a class="fn-backref" href="#id5">2</a></span></dt>
<dd><p>Smith and Nichols 2009, “Threshold-free cluster enhancement:
addressing problems of smoothing, threshold dependence, and
localisation in cluster inference”, NeuroImage 44 (2009) 83-98.</p>
</dd>
</dl>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  27.150 seconds)</p>
<p><strong>Estimated memory usage:</strong>  8 MB</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-tutorials-discussions-plot-background-statistics-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/64111b11ecb97eff546771c32aa6b7ff/plot_background_statistics.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_background_statistics.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/1935e973eb220e31cb4a6a6541231eb1/plot_background_statistics.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_background_statistics.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>
</div>


    </div>
    
  </div>
</div>
<footer class="footer">
  <div class="container"><div class="row">
    <div class="container col-md-12 institutions">
      <ul class="list-unstyled">
        <li><a href="https://www.massgeneral.org/"><img class="institution" src="../../_static/institution_logos/MGH.svg" title="Massachusetts General Hospital" alt="Massachusetts General Hospital"/></a></li>
        <li><a href="https://martinos.org/"><img class="institution" src="../../_static/institution_logos/Martinos.png" title="Athinoula A. Martinos Center for Biomedical Imaging" alt="Athinoula A. Martinos Center for Biomedical Imaging"/></a></li>
        <li><a href="https://hms.harvard.edu/"><img class="institution" src="../../_static/institution_logos/Harvard.png" title="Harvard Medical School" alt="Harvard Medical School"/></a></li>
        <li><a href="https://web.mit.edu/"><img class="institution" src="../../_static/institution_logos/MIT.svg" title="Massachusetts Institute of Technology" alt="Massachusetts Institute of Technology"/></a></li>
        <li><a href="https://www.nyu.edu/"><img class="institution" src="../../_static/institution_logos/NYU.png" title="New York University" alt="New York University"/></a></li>
        <li><a href="http://www.cea.fr/"><img class="institution" src="../../_static/institution_logos/CEA.png" title="Commissariat à l´énergie atomique et aux énergies alternatives" alt="Commissariat à l´énergie atomique et aux énergies alternatives"/></a></li>
        <li><a href="https://sci.aalto.fi/"><img class="institution" src="../../_static/institution_logos/Aalto.svg" title="Aalto-yliopiston perustieteiden korkeakoulu" alt="Aalto-yliopiston perustieteiden korkeakoulu"/></a></li>
        <li><a href="https://www.telecom-paris.fr/"><img class="institution" src="../../_static/institution_logos/Telecom_Paris_Tech.png" title="Télécom ParisTech" alt="Télécom ParisTech"/></a></li>
        <li><a href="https://www.washington.edu/"><img class="institution" src="../../_static/institution_logos/Washington.png" title="University of Washington" alt="University of Washington"/></a></li>
        <li><a href="https://icm-institute.org/"><img class="institution" src="../../_static/institution_logos/ICM.jpg" title="Institut du Cerveau et de la Moelle épinière" alt="Institut du Cerveau et de la Moelle épinière"/></a></li>
        <li><a href="https://www.bu.edu/"><img class="institution" src="../../_static/institution_logos/BU.svg" title="Boston University" alt="Boston University"/></a></li>
        <li><a href="https://www.inserm.fr/"><img class="institution" src="../../_static/institution_logos/Inserm.svg" title="Institut national de la santé et de la recherche médicale" alt="Institut national de la santé et de la recherche médicale"/></a></li>
        <li><a href="https://www.fz-juelich.de/"><img class="institution" src="../../_static/institution_logos/Julich.svg" title="Forschungszentrum Jülich" alt="Forschungszentrum Jülich"/></a></li>
        <li><a href="https://www.tu-ilmenau.de/"><img class="institution" src="../../_static/institution_logos/Ilmenau.gif" title="Technische Universität Ilmenau" alt="Technische Universität Ilmenau"/></a></li>
        <li><a href="https://bids.berkeley.edu/"><img class="institution" src="../../_static/institution_logos/BIDS.png" title="Berkeley Institute for Data Science" alt="Berkeley Institute for Data Science"/></a></li>
        <li><a href="https://www.inria.fr/"><img class="institution" src="../../_static/institution_logos/inria.png" title="Institut national de recherche en informatique et en automatique" alt="Institut national de recherche en informatique et en automatique"/></a></li>
        <li><a href="https://www.au.dk/"><img class="institution" src="../../_static/institution_logos/Aarhus.png" title="Aarhus Universitet" alt="Aarhus Universitet"/></a></li>
        <li><a href="https://www.uni-graz.at/"><img class="institution" src="../../_static/institution_logos/Graz.jpg" title="Karl-Franzens-Universität Graz" alt="Karl-Franzens-Universität Graz"/></a></li>
      </ul>
      <p class="text-center text-muted small">&copy; Copyright 2012-2020, MNE Developers. Last updated on 2020-03-27.</p>
    </div></div></div>
  </footer>
  <script src="https://mne.tools/versionwarning.js"></script>
  </body>
</html>